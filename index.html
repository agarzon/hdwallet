<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div id="qrcode"></div>

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/vue/dist/vue.js"></script>
    <script src="bower_components/bitcore-lib/bitcore-lib.js"></script>
    <script src="bower_components/bitcore-explorers/bitcore-explorers.js"></script>
    <script src="bower_components/bitcore-mnemonic/bitcore-mnemonic.js"></script>
    <script src="bower_components/jquery-qrcode/jquery.qrcode.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="js/nets.js"></script>
    <script src="js/wallet.js"></script>
    <script>

    var bitcore = require('bitcore-lib');
    var Insight = require('bitcore-explorers').Insight;
    var Mnemonic = require('bitcore-mnemonic');

    // Lets use the potcoin network
    var AltNet = new bitcore.Networks.add(PotNet);
    bitcore.Networks.defaultNetwork = AltNet;

    var insight = new Insight('https://chain.potcoin.com');

    // Word generation
    //var code = new Mnemonic(Mnemonic.Words.SPANISH);// Spanish
    //var code = new Mnemonic();// English
    //var nemo =code.toString(); // film speed midnight cave come federal horror unusual cute trap congress inherit
    //console.log(nemo);

    // Get private from seed with protection
    var code = new Mnemonic('film speed midnight cave come federal horror unusual cute trap congress inherit');
    var xpriv = code.toHDPrivateKey('superPassword');
    //console.log(xpriv); // 83eRLJFkhQGDSk2eGZmsqfJuwpEKKDyCMwb99AL3b8VEZzvCRPafNp1CQLm6cfAwMZz4hoFUV744ZvbE5JNgmZDVMXRtQgMALJPiM8evLSnNTdC5

    // Validate seed
    if (Mnemonic.isValid('film speed midnight cave come federal horror unusual cute trap congress inherit')) {
        console.log('Seed is valid');
    }

    // Validate address
    if (bitcore.Address.isValid('PRzNVTKRdm3U2feaZhrk13VfQUxp5J7BqK')) {
        console.log('Address is valid');
    }

    // Traditional single address generation
    /*
    var privateKey = new bitcore.PrivateKey();
    console.log('private : ' + privateKey);
    var address = privateKey.toAddress();
    console.log('address : ' + address);
    */

    /**
     * HD wallets generation
     */

    var hdPrivateKey = new bitcore.HDPrivateKey(xpriv);
    console.log(hdPrivateKey);
    var hdPublicKey = hdPrivateKey.hdPublicKey;
    console.log(hdPublicKey);
/*
    // Address from hdPublicKey
    var derivedAddress1 = new bitcore.Address(hdPublicKey.derive(0).publicKey).toString(); // PNcmn5pS5pDjriQcAE523SM7wAiaHTLNmv
    console.log(derivedAddress1);

    // Address from hdPrivateKey
    var derivedAddress2 = new bitcore.Address(hdPrivateKey.derive(0).publicKey).toString(); // PNcmn5pS5pDjriQcAE523SM7wAiaHTLNmv
    console.log(derivedAddress2);

    console.log((derivedAddress1 === derivedAddress2)); // They are the same
*/
    // Address from m/44" 81 for potcoin https://github.com/libbitcoin/libbitcoin/wiki/Altcoin-Version-Mappings
    var derivedAddress44 = new bitcore.Address(hdPrivateKey.derive("m/44'/81'/0'/0").derive(1, true).publicKey).toString();
    console.log(derivedAddress44); // PLtNzhajqDN6XLdhQa3vrJyXBGvXjjgbF2 working and confirmed

    for (var i = 0; i < 5; i++) {
        var derivedAddresses = new bitcore.Address(hdPrivateKey.derive("m/44'/81'/0'/0").derive(i, true).publicKey).toString();
        console.log(derivedAddresses);
    }

    // Convenient way to get utxos
    insight.getUnspentUtxos('PLtNzhajqDN6XLdhQa3vrJyXBGvXjjgbF2', function(err, utxos) {
        console.log(utxos);
        console.log(err);

        var AddressPrivateKey = new bitcore.PrivateKey(derivedAddress44.privateKey);
        console.log(AddressPrivateKey);

        var transaction = new bitcore.Transaction()
            .from(utxos)
            .to('PNcmn5pS5pDjriQcAE523SM7wAiaHTLNmv', 000100000)
            .change('PLtNzhajqDN6XLdhQa3vrJyXBGvXjjgbF2')
            //.fee(00003000)
            .sign(AddressPrivateKey);

        console.log(transaction);
        console.log("transaction = " + transaction.verify());
        console.log("Signature = " + transaction.isFullySigned());

        //var txSerialized = transaction.serialize();
        /*
        insight.broadcast(txSerialized, function(err, txId) {
            if (err) {
                console.log('Error!:'+err);
            } else {
                console.log('Successfully sent: '+txId);
            }
        });*/


    });


    $(function() {
        $('#qrcode').qrcode("this plugin is great");
    });

    </script>
</body>
</html>